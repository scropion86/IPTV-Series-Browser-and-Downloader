{% extends "base.html" %}

{% block content %}
    <div class="container">
        <a href="{{ url_for('movies_index') }}" class="button">‚Üê Return to Movie Categories</a>
        <h1 class="page-title">{{ category_name }}</h1>
        
        <div class="page-info">
            <div class="per-page-selector">
                <label for="perPageSelect">Items per page:</label>
                <select id="perPageSelect" onchange="changePerPage(this.value)">
                    <option value="10" {% if per_page == 10 %}selected{% endif %}>10</option>
                    <option value="20" {% if per_page == 20 %}selected{% endif %}>20</option>
                    <option value="30" {% if per_page == 30 %}selected{% endif %}>30</option>
                    <option value="40" {% if per_page == 40 %}selected{% endif %}>40</option>
                    <option value="50" {% if per_page == 50 %}selected{% endif %}>50</option>
                    <option value="60" {% if per_page == 60 %}selected{% endif %}>60</option>
                    <option value="70" {% if per_page == 70 %}selected{% endif %}>70</option>
                    <option value="80" {% if per_page == 80 %}selected{% endif %}>80</option>
                    <option value="90" {% if per_page == 90 %}selected{% endif %}>90</option>
                    <option value="100" {% if per_page == 100 %}selected{% endif %}>100</option>
                </select>
            </div>
        </div>

        <div class="series-grid">
            {% for movie in movies_list %}
            <div class="series-card">
                <div class="series-image">
                    <img src="{{ movie.stream_icon }}" alt="{{ movie.name }}" loading="lazy">
                </div>
                <div class="series-content">
                    <h2 class="series-title">{{ movie.name }}</h2>
                    <div class="movie-details">
                        {% if movie.rating %}
                        <p class="movie-rating">Rating: {{ movie.rating }}</p>
                        {% endif %}
                        {% if movie.year %}
                        <p class="movie-year">Year: {{ movie.year }}</p>
                        {% endif %}
                        {% if movie.genre %}
                        <p class="movie-genre">Genre: {{ movie.genre }}</p>
                        {% endif %}
                    </div>
                    <form action="{{ url_for('movie_download') }}" method="POST">
                        <input type="hidden" name="vod_id" value="{{ movie.stream_id }}">
                        <input type="hidden" name="referrer" value="category">
                        <button type="submit" class="button primary">View Details / Download</button>
                    </form>
                </div>
            </div>
            {% endfor %}
        </div>

        {% if total_pages > 1 %}
        <div class="pagination">
            {% if current_page > 1 %}
            <a href="{{ url_for('movies', category_id=category_id, page=current_page-1, per_page=per_page) }}" class="button">Previous</a>
            {% endif %}
            
            {% for p in range(1, total_pages + 1) %}
            <a href="{{ url_for('movies', category_id=category_id, page=p, per_page=per_page) }}" 
               class="button {% if p == current_page %}active{% endif %}">{{ p }}</a>
            {% endfor %}
            
            {% if current_page < total_pages %}
            <a href="{{ url_for('movies', category_id=category_id, page=current_page+1, per_page=per_page) }}" class="button">Next</a>
            {% endif %}
        </div>
        {% endif %}

        <script>
        function changePerPage(newPerPage) {
            const currentUrl = new URL(window.location);
            currentUrl.searchParams.set('per_page', newPerPage);
            currentUrl.searchParams.set('page', '1'); // Reset to first page
            window.location.href = currentUrl.toString();
        }
        </script>
    </div>
{% endblock %}